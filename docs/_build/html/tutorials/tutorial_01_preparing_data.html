

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Preparing and loading your data &mdash; SchNetPack 1.0rc documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> SchNetPack
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getstarted/getstarted.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getstarted/getstarted.html#scripts-for-benchmark-data-sets">Scripts for benchmark data sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getstarted/getstarted.html#using-scripts-with-custom-datasets">Using Scripts with custom Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getstarted/getstarted.html#using-argument-files-for-training">Using Argument Files for Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getstarted/getstarted.html#supported-models">Supported Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getstarted/getstarted.html#benchmark-datasets">Benchmark Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getstarted/getstarted.html#references">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getstarted/benchmarks.html">Benchmarks and Trained Models</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/base.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">schnetpack</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/data.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">schnetpack.data</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/datasets.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">schnetpack.datasets</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/environment.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">schnetpack.environment</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/nn.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">schnetpack.nn</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/representation.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">schnetpack.representation</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/atomistic.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">schnetpack.atomistic</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/train.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">schnetpack.train</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/md.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">schnetpack.md</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/utils.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">schnetpack.utils</span></code></a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SchNetPack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Preparing and loading your data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/tutorial_01_preparing_data.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Preparing-and-loading-your-data">
<h1>Preparing and loading your data<a class="headerlink" href="#Preparing-and-loading-your-data" title="Permalink to this headline">¶</a></h1>
<p>This tutorial introduces how SchNetPack stores and loads data. Before we can start training neural networks with SchNetPack, we need to prepare our data. This is because SchNetPack has to stream the reference data from disk during training in order to be able to handle large datasets. Therefore, it is crucial to use data format that allows for fast random read access. We found that the <a class="reference external" href="https://wiki.fysik.dtu.dk/ase/ase/db/db.html">ASE database format</a> fulfills perfectly. To further improve
the performance, we internally encode properties in binary. However, as long as you only access the ASE database via the provided SchNetPack <code class="docutils literal notranslate"><span class="pre">AtomsData</span></code> class, you don’t have to worry about that.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">schnetpack</span> <span class="k">import</span> <span class="n">AtomsData</span>
</pre></div>
</div>
</div>
<div class="section" id="Predefined-datasets">
<h2>Predefined datasets<a class="headerlink" href="#Predefined-datasets" title="Permalink to this headline">¶</a></h2>
<p>SchNetPack supports several benchmark datasets that can be used without preparation. Each one can be accessed using a corresponding class that inherits from <code class="docutils literal notranslate"><span class="pre">DownloadableAtomsData</span></code>, which supports automatic download and conversion. Here, we show how to use these data sets at the example of the QM9 benchmark.</p>
<p>First, we have to import the dataset class and instantiate it. This will automatically download the data to the specified location.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">schnetpack.datasets</span> <span class="k">import</span> <span class="n">QM9</span>

<span class="n">qm9data</span> <span class="o">=</span> <span class="n">QM9</span><span class="p">(</span><span class="s1">&#39;./qm9.db&#39;</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s have a closer look at this dataset. We can find out how large it is and which properties it supports:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of reference calculations:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">qm9data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Available properties:&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">qm9data</span><span class="o">.</span><span class="n">available_properties</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of reference calculations: 133885
Available properties:
- rotational_constant_A
- rotational_constant_B
- rotational_constant_C
- dipole_moment
- isotropic_polarizability
- homo
- lumo
- gap
- electronic_spatial_extent
- zpve
- energy_U0
- energy_U
- enthalpy_H
- free_energy
- heat_capacity
</pre></div></div>
</div>
<p>We can load data points using zero-base indexing. The result is a dictionary containing the geometry and properties:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">example</span> <span class="o">=</span> <span class="n">qm9data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Properties:&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">example</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Properties:
- rotational_constant_A : torch.Size([1])
- rotational_constant_B : torch.Size([1])
- rotational_constant_C : torch.Size([1])
- dipole_moment : torch.Size([1])
- isotropic_polarizability : torch.Size([1])
- homo : torch.Size([1])
- lumo : torch.Size([1])
- gap : torch.Size([1])
- electronic_spatial_extent : torch.Size([1])
- zpve : torch.Size([1])
- energy_U0 : torch.Size([1])
- energy_U : torch.Size([1])
- enthalpy_H : torch.Size([1])
- free_energy : torch.Size([1])
- heat_capacity : torch.Size([1])
- _atomic_numbers : torch.Size([5])
- _positions : torch.Size([5, 3])
- _cell : torch.Size([3, 3])
- _neighbors : torch.Size([5, 4])
- _cell_offset : torch.Size([5, 4, 3])
- _idx : torch.Size([1])
</pre></div></div>
</div>
<p>We see that all available properties have been loaded as torch tensors with the given shapes. Keys with an underscore indicate that these names are reserved for internal use. This includes the geometry (<code class="docutils literal notranslate"><span class="pre">_atomic_numbers</span></code>, <code class="docutils literal notranslate"><span class="pre">_positions</span></code>, <code class="docutils literal notranslate"><span class="pre">_cell</span></code>), the index within the dataset (<code class="docutils literal notranslate"><span class="pre">_idx</span></code>) as well as information about neighboring atoms and periodic boundary conditions (<code class="docutils literal notranslate"><span class="pre">_neighbors</span></code>, <code class="docutils literal notranslate"><span class="pre">_cell_offset</span></code>).</p>
<div class="admonition note">
<p><strong>Note:</strong> Neighbors are collected using an <code class="docutils literal notranslate"><span class="pre">EnvironmentProvider</span></code>, that can be passed to the <code class="docutils literal notranslate"><span class="pre">AtomsData</span></code> constructor. The default is the <code class="docutils literal notranslate"><span class="pre">SimpleEnvironmentProvider</span></code>, which constructs the neighbor list using a full distance matrix. This is suitable for small molecules. We supply environment providers using a cutoff (<code class="docutils literal notranslate"><span class="pre">AseEnvironmentProvider</span></code>, <code class="docutils literal notranslate"><span class="pre">TorchEnvironmentProvider</span></code>) that are able to handle larger molecules and periodic boundary conditions.</p>
</div>
<p>We can directly obtain an ASE atoms object as follows:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">at</span> <span class="o">=</span> <span class="n">qm9data</span><span class="o">.</span><span class="n">get_atoms</span><span class="p">(</span><span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Atoms object:&#39;</span><span class="p">,</span> <span class="n">at</span><span class="p">)</span>

<span class="n">at2</span><span class="p">,</span> <span class="n">props</span> <span class="o">=</span> <span class="n">qm9data</span><span class="o">.</span><span class="n">get_properties</span><span class="p">(</span><span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Atoms object (not the same):&#39;</span><span class="p">,</span> <span class="n">at2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Equivalent:&#39;</span><span class="p">,</span> <span class="n">at2</span> <span class="o">==</span> <span class="n">at</span><span class="p">,</span> <span class="s1">&#39;; not the same object:&#39;</span><span class="p">,</span> <span class="n">at2</span> <span class="ow">is</span> <span class="n">at</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Atoms object: Atoms(symbols=&#39;CH4&#39;, pbc=False)
Atoms object (not the same): Atoms(symbols=&#39;CH4&#39;, pbc=False)
Equivalent: True ; not the same object: False
</pre></div></div>
</div>
<p>Alternatively, all property names are pre-defined as class-variable for convenient access:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total energy at 0K:&#39;</span><span class="p">,</span> <span class="n">props</span><span class="p">[</span><span class="n">QM9</span><span class="o">.</span><span class="n">U0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;HOMO:&#39;</span><span class="p">,</span> <span class="n">props</span><span class="p">[</span><span class="n">QM9</span><span class="o">.</span><span class="n">homo</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Total energy at 0K: tensor([-1101.4878])
HOMO: tensor([-10.5499])
</pre></div></div>
</div>
</div>
<div class="section" id="Preparing-your-own-data">
<h2>Preparing your own data<a class="headerlink" href="#Preparing-your-own-data" title="Permalink to this headline">¶</a></h2>
<p>In the following we will create an ASE database from our own data. For this tutorial, we will use a dataset containing a molecular dynamics (MD) trajectory of ethanol, which can be downloaded <a class="reference external" href="http://quantum-machine.org/gdml/data/xyz/ethanol_dft.zip">here</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;./ethanol_dft.zip&#39;</span><span class="p">):</span>
    <span class="o">!</span>wget http://quantum-machine.org/gdml/data/xyz/ethanol_dft.zip

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;./ethanol.xyz&#39;</span><span class="p">):</span>
    <span class="o">!</span>unzip ./ethanol_dft.zip
</pre></div>
</div>
</div>
<p>The data set is in xyz format with the total energy given in the comment row. For this kind of data, we supply a script that converts it into the SchNetPack ASE DB format.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">schnetpack_parse</span><span class="o">.</span><span class="n">py</span> <span class="o">./</span><span class="n">ethanol</span><span class="o">.</span><span class="n">xyz</span> <span class="o">./</span><span class="n">ethanol</span><span class="o">.</span><span class="n">db</span>
</pre></div>
</div>
<p>In the following, we show how this can be done in general, so that you apply this to any other data format.</p>
<p>First, we need to parse our data. For this we use the IO functionality supplied by ASE. In order to create a SchNetPack DB, we require a <strong>list of ASE ``Atoms`` objects</strong> as well as a corresponding <strong>list of dictionaries</strong> <code class="docutils literal notranslate"><span class="pre">[{property_name1:</span> <span class="pre">property1_molecule1},</span> <span class="pre">{property_name1:</span> <span class="pre">property1_molecule2},</span> <span class="pre">...]</span></code> containing the mapping from property names to values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">ase.io</span> <span class="k">import</span> <span class="n">read</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># load atoms from xyz file. Here, we only parse the first 10 molecules</span>
<span class="n">atoms</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="s1">&#39;./ethanol.xyz&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;:10&#39;</span><span class="p">)</span>

<span class="c1"># comment line is weirdly stored in the info dictionary as key by ASE. here it corresponds to the energy</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Energy:&#39;</span><span class="p">,</span> <span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="c1"># parse properties as list of dictionaries</span>
<span class="n">property_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
    <span class="c1"># All properties need to be stored as numpy arrays.</span>
    <span class="c1"># Note: The shape for scalars should be (1,), not ()</span>
    <span class="c1"># Note: GPUs work best with float32 data</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">at</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">])],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">property_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span><span class="s1">&#39;energy&#39;</span><span class="p">:</span> <span class="n">energy</span><span class="p">}</span>
    <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Properties:&#39;</span><span class="p">,</span> <span class="n">property_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Energy: {&#39;-97208.40600498248&#39;: True}

Properties: [{&#39;energy&#39;: array([-97208.41], dtype=float32)}, {&#39;energy&#39;: array([-97208.375], dtype=float32)}, {&#39;energy&#39;: array([-97208.04], dtype=float32)}, {&#39;energy&#39;: array([-97207.5], dtype=float32)}, {&#39;energy&#39;: array([-97206.84], dtype=float32)}, {&#39;energy&#39;: array([-97206.1], dtype=float32)}, {&#39;energy&#39;: array([-97205.266], dtype=float32)}, {&#39;energy&#39;: array([-97204.29], dtype=float32)}, {&#39;energy&#39;: array([-97203.16], dtype=float32)}, {&#39;energy&#39;: array([-97201.875], dtype=float32)}]
</pre></div></div>
</div>
<p>Once we have our data in this format, it is straightforward to create a new SchNetPack DB and store it.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">rm</span> &#39;./new_dataset.db&#39;
<span class="n">new_dataset</span> <span class="o">=</span> <span class="n">AtomsData</span><span class="p">(</span><span class="s1">&#39;./new_dataset.db&#39;</span><span class="p">,</span> <span class="n">available_properties</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])</span>
<span class="n">new_dataset</span><span class="o">.</span><span class="n">add_systems</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">property_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now we can have a look at the data in the same way we did before for QM9:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of reference calculations:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_dataset</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Available properties:&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">new_dataset</span><span class="o">.</span><span class="n">available_properties</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="n">example</span> <span class="o">=</span> <span class="n">new_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Properties of molecule with id 0:&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">example</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of reference calculations: 10
Available properties:
- energy

Properties of molecule with id 0:
- energy : torch.Size([1])
- _atomic_numbers : torch.Size([9])
- _positions : torch.Size([9, 3])
- _cell : torch.Size([3, 3])
- _neighbors : torch.Size([9, 8])
- _cell_offset : torch.Size([9, 8, 3])
- _idx : torch.Size([1])
</pre></div></div>
</div>
<p>The same way, we can store multiple properties, including atomic properties such as forces, or tensorial properties such as polarizability tensors.</p>
<p>In the following tutorials, we will describe how these datasets can be used to train neural networks.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Wujie Wang, Daniel Schwalbe-Koda

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>